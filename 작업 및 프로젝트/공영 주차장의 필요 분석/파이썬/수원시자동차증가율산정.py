# -*- coding: utf-8 -*-
# 수원시 자동차 증가율 계산
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# 출처(국토교통 통계누리) : https://stat.molit.go.kr/portal/cate/statMetaView.do?hRsId=58
# 매년 12월말 기준 자동차등록자료 통계(엑셀)자료를 다운로드후, 
# 엑셀에서 1차 전처리함. 경기도만 소트
df = pd.read_excel(r"E:\workspace\python\miniproject\본프로젝트\2013년부터2023년자동차등록현황.xlsx")

# 열이름 오타 수정하기
df.rename(columns={'승용걔':'승용계'}, inplace=True)

# 필요없는 행 삭제하기 : 계 삭제
df = df.drop(index=43)

# 용어 통일하기 : '시군구' 열의 값을 변경
df['시군구'] = df['시군구'].replace('수원시 권선구', '수원 권선')
df['시군구'] = df['시군구'].replace('수원시 장안구', '수원 장안')
df['시군구'] = df['시군구'].replace('수원시 팔달구', '수원 팔달')
df['시군구'] = df['시군구'].replace('수원시 영통구', '수원 영통')

# 연도별, 시군구별 합계 산출
grouped_df = df.groupby(['년도', '시군구']).sum().reset_index()

# '수원'을 포함하는 시군구 필터링
filtered_df = grouped_df[grouped_df['시군구'].str.contains('수원')]

df = filtered_df

# 연도별 총 등록대수 합계 계산
yearly_total = df.groupby('년도')['총계'].sum().reset_index()

# 연도별 증가율 계산
yearly_total['증가율'] = yearly_total['총계'].pct_change() * 100

df1 = yearly_total

# 전체 기간 평균 증가율 계산 (기하평균 사용)
n = len(df1)
total_growth_rate = (df1['총계'].iloc[-1] / df1['총계'].iloc[0]) ** (1/(n-1)) - 1
print(f"\n전체 기간 평균 연간 증가율: {total_growth_rate:.2%}")

### 전체 기간 평균 연간 증가율: 3.30%


# 전체 기간 평균 연간 증가율은 기하 평균을 사용하는 방식이 맞다고 함.
# 전체 기간 평균 연간 증가율을 계산할 때 기하 평균을 사용하는 이유는 
# 기하 평균이 연속적인 비율 증가의 평균을 나타내기 때문입니다. 이는 투자 
# 수익률, 경제 성장률, 인구 성장률 등과 같은 시계열 데이터에서 더 적절하게 
# 평균 증가율을 나타낼 수 있습니다. 

# 구체적인 이유는 다음과 같습니다:

# 복리 효과 반영: 기하 평균은 연간 증가율이 연속적으로 곱해지는 복리 효과를 
# 반영합니다. 이는 각 연도의 증가율이 다음 연도의 기반이 되는 경우에 중요합니다. 
# 예를 들어, 첫 해에 10% 증가한 후 두 번째 해에 10% 증가하면, 두 번째 해의 
# 10%는 첫 해의 10% 증가한 값에 적용됩니다. 기하 평균은 이러한 복리 효과를 적절히 반영합니다.

# 비율 데이터에 적합: 증가율은 비율로 표현되는 데이터입니다. 비율 데이터의 
# 평균을 계산할 때 산술 평균을 사용하면 비율이 합산되므로 왜곡이 발생할 수 
# 있습니다. 기하 평균은 이러한 비율 데이터의 평균을 더 정확하게 계산할 수 있습니다.

# 극단값의 영향 최소화: 산술 평균은 극단값의 영향을 크게 받지만, 기하 평균은 
# 극단값의 영향을 상대적으로 덜 받습니다. 이는 비율 데이터에서 극단값이 
# 존재할 때 평균 증가율을 계산하는 데 유리합니다.

